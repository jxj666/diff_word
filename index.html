<!--
 * @Description: 
 * @Author: jinxiaojian
 * @Email: jinxiaojian@youxin.com
 * @Date: 2019-07-11 11:02:54
 * @LastEditTime: 2021-11-20 21:15:23
 * @LastEditors: jinxiaojian
 -->
<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>文档对比器</title>
	<link rel="stylesheet" href="./style.css">
	<link rel="icon" href="./favicon.ico">

</head>

<body>

	<div id="settings">
		<h1>文档对比器</h1>
		<div>
			<a href="http://jxjweb.top">jxjweb.top</a>
			<span>&nbsp;</span>
			<a href="https://github.com/jxj322991/diff_word">github</a>
		</div>
		<div>
			<h1>结果框宽度</h1>
			<button onclick='cssChange(0,95)'>最大</button>
			<button onclick='cssChange(1,0)'>➕</button>
			<button onclick='cssChange(-1,0)'>➖</button>
			<button onclick='cssChange(0,5)'>最小</button>
		</div>
		<div>
			<h1>对比精细度</h1>
			<input placeholder="文段1" type="radio" name="diff_type" value="diffChars" checked=""> 字
			<input placeholder="文段2" type="radio" name="diff_type" value="diffWords"> 词
			<input type="radio" name="diff_type" value="diffLines"> 行
		</div>
		<div>
			<button onclick='changed()'>
				<h3>开始对比</h3>
			</button>
		</div>
	</div>



	<div id='content'>
		<table>
			<tbody>
				<tr>
					<td contenteditable="true" id="a"></td>
					<td contenteditable="true" id="b"></td>
					<td id="c">
						<pre id="result"></pre>
					</td>
				</tr>
			</tbody>
		</table>
	</div>

	<script src="./cssChange.js"></script>
	<script src="./diff.js"></script>
	<script defer="">
		var a = document.getElementById('a');
		var b = document.getElementById('b');
		var c = document.getElementById('c');

		var result = document.getElementById('result');

		function changed() {
			var diff = JsDiff[window.diffType](a.textContent, b.textContent);
			var fragment = document.createDocumentFragment();
			for (var i = 0; i < diff.length; i++) {

				if (diff[i].added && diff[i + 1] && diff[i + 1].removed) {
					var swap = diff[i];
					diff[i] = diff[i + 1];
					diff[i + 1] = swap;
				}

				var node;
				if (diff[i].removed) {
					node = document.createElement('del');
					node.appendChild(document.createTextNode(diff[i].value));
				} else if (diff[i].added) {
					node = document.createElement('ins');
					node.appendChild(document.createTextNode(diff[i].value));
				} else {
					node = document.createTextNode(diff[i].value);
				}
				fragment.appendChild(node);
			}

			result.textContent = '';
			result.appendChild(fragment);
		}

		window.onload = function () {
			onDiffTypeChange(document.querySelector('#settings [name="diff_type"]:checked'));

		};

		// a.onpaste = a.onchange =
		// 	b.onpaste = b.onchange = changed;

		// if ('oninput' in a) {
		// 	a.oninput = b.oninput = changed;
		// } else {
		// 	a.onkeyup = b.onkeyup = changed;
		// }

		function onDiffTypeChange(radio) {
			window.diffType = radio.value;
		}
		var radio = document.getElementsByName('diff_type');
		for (var i = 0; i < radio.length; i++) {
			radio[i].onchange = function (e) {
				onDiffTypeChange(e.target);
				changed();
			}
		}
	</script>


</body>

</html>